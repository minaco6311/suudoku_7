<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Êï∞Áã¨„Éë„Ç∫„É´</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Sans', sans-serif;
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: linear-gradient(180deg, #fffaf5 0%, #fff5eb 100%);
      border-radius: 24px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(180, 130, 100, 0.25);
      text-align: center;
      max-width: 500px;
      border: 2px solid #f5e6d3;
    }
    h1 { 
      color: #8b5a2b; 
      margin-bottom: 10px; 
      font-size: 26px;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }
    .info-bar {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .info-item {
      background: linear-gradient(135deg, #fff8f0, #ffedd5);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      color: #7a5230;
      border: 1px solid #f0d9c0;
      box-shadow: 0 2px 4px rgba(180, 130, 100, 0.1);
    }
    .timer {
      font-family: monospace;
      font-size: 16px;
      font-weight: bold;
      color: #d2691e;
    }
    .mini-pause-btn {
      background: linear-gradient(135deg, #a9a9a9, #909090);
      color: white;
      border: none;
      border-radius: 6px;
      width: 24px;
      height: 24px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 6px;
      vertical-align: middle;
      transition: transform 0.2s;
    }
    .mini-pause-btn:hover {
      transform: scale(1.1);
    }
    .best-records {
      background: linear-gradient(135deg, #fff3e0, #ffe4c4);
      border-radius: 16px;
      padding: 12px 15px;
      margin-bottom: 12px;
      border: 1px solid #f0d9c0;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.5);
    }
    .best-title {
      font-size: 14px;
      font-weight: bold;
      color: #cd853f;
      margin-bottom: 6px;
    }
    .best-list {
      display: flex;
      justify-content: center;
      gap: 15px;
      font-size: 13px;
    }
    .best-item { color: #8b6914; }
    .best-item .rank { color: #d2691e; font-weight: bold; }
    .best-item .time { font-family: monospace; font-weight: bold; color: #6b4423; }
    .difficulty-select {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    .diff-btn {
      padding: 20px 40px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    .diff-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .beginner { background: linear-gradient(135deg, #98d89e, #7bc47f); }
    .easy { background: linear-gradient(135deg, #87ceeb, #6bb8d9); }
    .medium { background: linear-gradient(135deg, #f4a460, #e8935a); }
    .hard { background: linear-gradient(135deg, #e07a7a, #d35f5f); }
    .number-pad {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin: 12px 0;
      flex-wrap: wrap;
    }
    .num-btn {
      width: 36px;
      height: 36px;
      font-size: 18px;
      font-weight: bold;
      color: #5a3d2b;
      background: linear-gradient(180deg, #fff8f0, #ffe4c9);
      border: 2px solid #e0c4a8;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 3px 6px rgba(180, 130, 100, 0.2);
    }
    .num-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(180, 130, 100, 0.3);
      background: linear-gradient(180deg, #fff, #fff0e0);
    }
    .num-btn:active { transform: translateY(0); }
    .num-btn.clear {
      background: linear-gradient(180deg, #f5e6d8, #e8d5c4);
      font-size: 12px;
      color: #8b7355;
    }
    .num-btn:disabled { 
      opacity: 0.5; 
      cursor: not-allowed; 
      transform: none; 
    }
    .sudoku-board {
      display: inline-grid;
      grid-template-columns: repeat(9, 36px);
      gap: 0;
      border: 3px solid #a67c52;
      margin: 10px 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(166, 124, 82, 0.3);
    }
    .cell {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      border: 1px solid #d4b896;
      cursor: pointer;
      transition: background 0.2s;
      user-select: none;
      background: #fffcf8;
    }
    .cell.given { 
      background: linear-gradient(135deg, #f5e6d3, #efe0cc); 
      color: #5a3d2b; 
      cursor: default; 
    }
    .cell.user { background: #fffcf8; color: #5a3d2b; }
    .cell.error { background: #fffcf8; color: #a85a5a; }
    .cell.hint-cell { background: #fff8dc; color: #b8860b; }
    .cell.selected { 
      background: #ffecd2; 
      box-shadow: inset 0 0 0 3px #e8935a; 
    }
    .cell.right-border { border-right: 2px solid #a67c52; }
    .cell.bottom-border { border-bottom: 2px solid #a67c52; }
    .cell.paused { color: transparent; background: #f5e6d3; }
    .buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .btn {
      padding: 10px 16px;
      font-size: 13px;
      font-weight: bold;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    .btn:hover { transform: translateY(-2px); opacity: 0.9; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-hint { background: linear-gradient(135deg, #dda0dd, #c98bc9); }
    .btn-answer { background: linear-gradient(135deg, #f4a460, #e8935a); }
    .btn-new { background: linear-gradient(135deg, #87ceeb, #6bb8d9); }
    .btn-quit { background: linear-gradient(135deg, #e07a7a, #d35f5f); }
    .btn-pause { background: linear-gradient(135deg, #a9a9a9, #909090); }
    .complete-msg {
      background: linear-gradient(135deg, #98d89e, #7bc47f);
      color: white;
      padding: 12px 20px;
      border-radius: 16px;
      margin-bottom: 12px;
      font-size: 16px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      box-shadow: 0 4px 12px rgba(123, 196, 127, 0.4);
    }
    .pause-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(139, 90, 43, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .pause-modal {
      background: linear-gradient(180deg, #fffaf5, #fff5eb);
      padding: 40px;
      border-radius: 24px;
      text-align: center;
      border: 2px solid #f5e6d3;
      box-shadow: 0 10px 40px rgba(180, 130, 100, 0.4);
    }
    .pause-modal h2 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #8b5a2b;
    }
    .pause-modal .btn {
      padding: 15px 40px;
      font-size: 18px;
      background: linear-gradient(135deg, #98d89e, #7bc47f);
    }
    .hidden { display: none; }
    .select-hint {
      color: #a67c52;
      font-size: 13px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß© Êï∞Áã¨„Éë„Ç∫„É´</h1>
    
    <div id="menu-screen">
      <p style="color: #a67c52; margin-bottom: 10px;">Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
      <div class="difficulty-select">
        <button class="diff-btn beginner" onclick="startGame('beginner')">ÂÖ•ÈñÄ</button>
        <button class="diff-btn easy" onclick="startGame('easy')">ÂàùÁ¥ö</button>
        <button class="diff-btn medium" onclick="startGame('medium')">‰∏≠Á¥ö</button>
        <button class="diff-btn hard" onclick="startGame('hard')">‰∏äÁ¥ö</button>
      </div>
    </div>
    
    <div id="game-screen" class="hidden">
      <div class="info-bar">
        <div class="info-item">Èõ£ÊòìÂ∫¶: <span id="diff-name"></span></div>
        <div class="info-item">‚è± <span id="timer" class="timer">00:00</span> <button class="mini-pause-btn" id="mini-pause-btn" onclick="togglePause()">‚è∏</button></div>
        <div class="info-item">üí° „Éí„É≥„Éà: <span id="hint-count">3</span>Âõû</div>
      </div>
      
      <div class="best-records">
        <div class="best-title">üèÜ „Éô„Çπ„Éà3</div>
        <div id="best-list" class="best-list">
          <div class="best-item"><span class="rank">1‰Ωç</span> <span class="time">--:--</span></div>
          <div class="best-item"><span class="rank">2‰Ωç</span> <span class="time">--:--</span></div>
          <div class="best-item"><span class="rank">3‰Ωç</span> <span class="time">--:--</span></div>
        </div>
      </div>
      
      <div id="complete-msg" class="complete-msg hidden"></div>
      
      <div class="number-pad">
        <button class="num-btn" id="num1" onclick="inputNumber(1)">1</button>
        <button class="num-btn" id="num2" onclick="inputNumber(2)">2</button>
        <button class="num-btn" id="num3" onclick="inputNumber(3)">3</button>
        <button class="num-btn" id="num4" onclick="inputNumber(4)">4</button>
        <button class="num-btn" id="num5" onclick="inputNumber(5)">5</button>
        <button class="num-btn" id="num6" onclick="inputNumber(6)">6</button>
        <button class="num-btn" id="num7" onclick="inputNumber(7)">7</button>
        <button class="num-btn" id="num8" onclick="inputNumber(8)">8</button>
        <button class="num-btn" id="num9" onclick="inputNumber(9)">9</button>
        <button class="num-btn clear" id="num0" onclick="inputNumber(0)">Ê∂à„Åô</button>
      </div>
      
      <div id="select-hint" class="select-hint">„Éû„Çπ„Çí„Çø„ÉÉ„Éó„Åó„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
      
      <div id="board" class="sudoku-board"></div>
      
      <div class="buttons">
        <button class="btn btn-pause" id="pause-btn" onclick="togglePause()">‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢</button>
        <button class="btn btn-hint" onclick="useHint()">üí° „Éí„É≥„Éà</button>
        <button class="btn btn-answer" id="answer-btn" onclick="toggleAnswer()">Á≠î„Åà„ÇíË¶ã„Çã</button>
        <button class="btn btn-new" onclick="newGame()">Êñ∞„Åó„ÅÑÂïèÈ°å</button>
        <button class="btn btn-quit" onclick="quitGame()">üö™ „ÇÑ„ÇÅ„Çã</button>
      </div>
    </div>
    
    <div id="pause-overlay" class="pause-overlay hidden">
      <div class="pause-modal">
        <h2>‚òï „Å≤„Å®‰ºë„Åø‰∏≠</h2>
        <button class="btn" onclick="togglePause()">‚ñ∂ ÂÜçÈñã„Åô„Çã</button>
      </div>
    </div>
  </div>

  <script>
    let puzzle = [], solution = [], userInput = [];
    let difficulty = null;
    let timer = 0, timerInterval = null;
    let hintCount = 3;
    let showingAnswer = false;
    let isComplete = false;
    let selectedCell = null;
    let isPaused = false;
    let bestRecords = {
      beginner: [],
      easy: [],
      medium: [],
      hard: []
    };

    const difficulties = {
      beginner: { name: 'ÂÖ•ÈñÄ', hints: 40 },
      easy: { name: 'ÂàùÁ¥ö', hints: 35 },
      medium: { name: '‰∏≠Á¥ö', hints: 30 },
      hard: { name: '‰∏äÁ¥ö', hints: 25 }
    };

    function generateSudoku() {
      const board = Array(9).fill(null).map(() => Array(9).fill(0));
      
      function isValid(board, row, col, num) {
        for (let x = 0; x < 9; x++) {
          if (board[row][x] === num || board[x][col] === num) return false;
        }
        const boxRow = Math.floor(row / 3) * 3;
        const boxCol = Math.floor(col / 3) * 3;
        for (let i = 0; i < 3; i++) {
          for (let j = 0; j < 3; j++) {
            if (board[boxRow + i][boxCol + j] === num) return false;
          }
        }
        return true;
      }

      function solve(board) {
        for (let row = 0; row < 9; row++) {
          for (let col = 0; col < 9; col++) {
            if (board[row][col] === 0) {
              const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
              for (let num of nums) {
                if (isValid(board, row, col, num)) {
                  board[row][col] = num;
                  if (solve(board)) return true;
                  board[row][col] = 0;
                }
              }
              return false;
            }
          }
        }
        return true;
      }

      solve(board);
      return board;
    }

    function createPuzzle(sol, hintCount) {
      const puz = sol.map(row => [...row]);
      const positions = [];
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          positions.push([i, j]);
        }
      }
      positions.sort(() => Math.random() - 0.5);
      const removeCount = 81 - hintCount;
      for (let i = 0; i < removeCount; i++) {
        const [row, col] = positions[i];
        puz[row][col] = 0;
      }
      return puz;
    }

    function startGame(diff) {
      difficulty = diff;
      solution = generateSudoku();
      puzzle = createPuzzle(solution, difficulties[diff].hints);
      userInput = puzzle.map(row => [...row]);
      hintCount = 3;
      timer = 0;
      isComplete = false;
      showingAnswer = false;
      selectedCell = null;
      isPaused = false;

      document.getElementById('menu-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      document.getElementById('diff-name').textContent = difficulties[diff].name;
      document.getElementById('hint-count').textContent = hintCount;
      document.getElementById('complete-msg').classList.add('hidden');
      document.getElementById('answer-btn').textContent = 'Á≠î„Åà„ÇíË¶ã„Çã';
      document.getElementById('select-hint').textContent = '„Éû„Çπ„Çí„Çø„ÉÉ„Éó„Åó„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
      document.getElementById('pause-btn').textContent = '‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢';

      updateBestDisplay();
      renderBoard();
      startTimer();
    }

    function renderBoard() {
      const board = document.getElementById('board');
      board.innerHTML = '';
      const data = showingAnswer ? solution : userInput;

      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          
          if (isPaused) {
            cell.classList.add('paused');
            cell.textContent = '';
          } else {
            cell.textContent = data[i][j] === 0 ? '' : data[i][j];
          }

          if ((j + 1) % 3 === 0 && j !== 8) cell.classList.add('right-border');
          if ((i + 1) % 3 === 0 && i !== 8) cell.classList.add('bottom-border');

          if (puzzle[i][j] !== 0) {
            cell.classList.add('given');
          } else if (showingAnswer) {
            cell.classList.add('hint-cell');
          } else {
            cell.classList.add('user');
            if (!isPaused && userInput[i][j] !== 0 && userInput[i][j] !== solution[i][j]) {
              cell.classList.add('error');
            }
            if (!isPaused && selectedCell && selectedCell.row === i && selectedCell.col === j) {
              cell.classList.add('selected');
            }
            const row = i, col = j;
            cell.addEventListener('click', () => selectCell(row, col));
          }

          board.appendChild(cell);
        }
      }
    }

    function selectCell(row, col) {
      if (showingAnswer || isComplete || isPaused) return;
      selectedCell = { row, col };
      document.getElementById('select-hint').textContent = `ÈÅ∏Êäû‰∏≠: ${row + 1}Ë°å ${col + 1}Âàó ‚Üí Êï∞Â≠ó„Çí„Çø„ÉÉ„Éó`;
      renderBoard();
    }

    function inputNumber(num) {
      if (!selectedCell || showingAnswer || isComplete || isPaused) return;
      const { row, col } = selectedCell;
      userInput[row][col] = num;
      renderBoard();
      checkComplete();
    }

    function checkComplete() {
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          if (userInput[i][j] !== solution[i][j]) return;
        }
      }
      isComplete = true;
      stopTimer();
      selectedCell = null;
      
      saveBestRecord(timer);
      
      const msg = document.getElementById('complete-msg');
      msg.textContent = `üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„ÇØ„É™„Ç¢„Çø„Ç§„É†: ${formatTime(timer)}`;
      msg.classList.remove('hidden');
      document.getElementById('select-hint').textContent = '„ÇØ„É™„Ç¢ÔºÅ';
    }

    function saveBestRecord(time) {
      bestRecords[difficulty].push(time);
      bestRecords[difficulty].sort((a, b) => a - b);
      bestRecords[difficulty] = bestRecords[difficulty].slice(0, 3);
      updateBestDisplay();
    }

    function updateBestDisplay() {
      const records = bestRecords[difficulty] || [];
      const ranks = ['1‰Ωç', '2‰Ωç', '3‰Ωç'];
      let html = '';
      for (let i = 0; i < 3; i++) {
        const time = records[i] ? formatTime(records[i]) : '--:--';
        html += `<div class="best-item"><span class="rank">${ranks[i]}</span> <span class="time">${time}</span></div>`;
      }
      document.getElementById('best-list').innerHTML = html;
    }

    function togglePause() {
      if (isComplete) return;
      
      isPaused = !isPaused;
      
      if (isPaused) {
        stopTimer();
        document.getElementById('pause-overlay').classList.remove('hidden');
        document.getElementById('pause-btn').textContent = '‚ñ∂ ÂÜçÈñã';
        document.getElementById('mini-pause-btn').textContent = '‚ñ∂';
        setNumberPadDisabled(true);
      } else {
        document.getElementById('pause-overlay').classList.add('hidden');
        document.getElementById('pause-btn').textContent = '‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢';
        document.getElementById('mini-pause-btn').textContent = '‚è∏';
        setNumberPadDisabled(false);
        startTimer();
      }
      renderBoard();
    }

    function setNumberPadDisabled(disabled) {
      for (let i = 0; i <= 9; i++) {
        const btn = document.getElementById('num' + i);
        if (btn) btn.disabled = disabled;
      }
    }

    function useHint() {
      if (hintCount <= 0 || isComplete || isPaused) return;

      const emptyCells = [];
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          if (userInput[i][j] === 0 || userInput[i][j] !== solution[i][j]) {
            emptyCells.push([i, j]);
          }
        }
      }

      if (emptyCells.length === 0) return;

      const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      userInput[row][col] = solution[row][col];
      hintCount--;
      document.getElementById('hint-count').textContent = hintCount;
      renderBoard();
      checkComplete();
    }

    function toggleAnswer() {
      if (isPaused) return;
      showingAnswer = !showingAnswer;
      selectedCell = null;
      document.getElementById('answer-btn').textContent = showingAnswer ? 'ÂïèÈ°å„Å´Êàª„Çã' : 'Á≠î„Åà„ÇíË¶ã„Çã';
      document.getElementById('select-hint').textContent = showingAnswer ? 'Á≠î„ÅàË°®Á§∫‰∏≠' : '„Éû„Çπ„Çí„Çø„ÉÉ„Éó„Åó„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
      renderBoard();
    }

    function newGame() {
      stopTimer();
      isPaused = false;
      document.getElementById('pause-overlay').classList.add('hidden');
      startGame(difficulty);
    }

    function quitGame() {
      stopTimer();
      isPaused = false;
      document.getElementById('pause-overlay').classList.add('hidden');
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('menu-screen').classList.remove('hidden');
    }

    function startTimer() {
      stopTimer();
      timerInterval = setInterval(() => {
        timer++;
        document.getElementById('timer').textContent = formatTime(timer);
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
  </script>
</body>
</html>
